[gd_scene load_steps=5 format=2]

[ext_resource path="res://resources/water/noise.png" type="Texture" id=1]
[ext_resource path="res://resources/water/water.png" type="Texture" id=3]


[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float wave_speed = 1.0;
uniform float noise_speed = 1.0;
uniform float noise_ratio = 0.1;
uniform sampler2D noise_img;

void fragment(){
    vec2 newuv = UV;
    newuv.y -= TIME * wave_speed;
    vec4 c = texture(TEXTURE, newuv);
//    COLOR = c;
	vec2 uv1 = vec2(UV.x, UV.y + TIME * noise_speed);
	vec2 uv2 = vec2(UV.x, UV.y - TIME * noise_speed);
	vec2 uv3 = vec2(UV.x + TIME * noise_speed, UV.y);
	
	float noise_r = texture(noise_img, uv1).r * noise_ratio;
	float noise_g = texture(noise_img, uv2).g * noise_ratio;
	float noise_b = texture(noise_img, uv3).b * noise_ratio;
	
	vec3 new_color = vec3(noise_r + c.r * (1.0 - noise_ratio), noise_g + c.g * (1.0 - noise_ratio), noise_b + c.b * (1.0 - noise_ratio));
	
	COLOR.rgb = new_color;
	COLOR.a = texture(TEXTURE, UV).a;
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/wave_speed = 1.118
shader_param/noise_speed = 1.0
shader_param/noise_ratio = 0.1
shader_param/noise_img = ExtResource( 1 )

[node name="Water" type="Sprite"]
material = SubResource( 2 )
position = Vector2( 512, 300 )
z_index = -1
texture = ExtResource( 3 )
region_enabled = true
region_rect = Rect2( 0, 0, 1024, 600 )
